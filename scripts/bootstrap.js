// ============================================================
// üß† AI Podcast Suite ‚Äî Bootstrap Sequence
// ============================================================
// Ensures all RSS feed data and R2 text assets are initialized
// before the web server starts.
// ============================================================

import { execSync } from "child_process";
import { log } from "#logger.js";

async function run(cmd, label) {
  try {
    log.info(`üöÄ Running ${label}...`);
    execSync(cmd, { stdio: "inherit" });
    log.info(`‚úÖ ${label} completed successfully.`);
  } catch (err) {
    log.error(`‚ùå ${label} failed: ${err.message}`);
  }
}

(async () => {
  log.info("üß© Starting AI Podcast Suite bootstrap sequence...");
  log.info("---------------------------------------------");

  // 1Ô∏è‚É£ Load and validate environment variables
  await run("node ./scripts/envBootstrap.js", "Environment Bootstrap");

  // 2Ô∏è‚É£ Initialize RSS feed data into R2 (critical)
  await run("node ./services/rss-feed-creator/startup/rss-init.js", "RSS Init");

  // 3Ô∏è‚É£ Perform runtime sanity checks
  await run("node ./scripts/startupCheck.js", "Startup Check");

  // 4Ô∏è‚É£ Validate temp storage + Cloudflare R2 connectivity
  await run("node ./scripts/tempStorage.js", "R2 Check");

  // 5Ô∏è‚É£ Launch the main web server
  await run("node ./server.js", "Start Server");

  log.info("---------------------------------------------");
  log.info("üí§ Bootstrap complete ‚Äî container entering idle mode.");
})();
